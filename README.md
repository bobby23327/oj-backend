# Linux OJ è¯„æµ‹æ ¸å¿ƒ

ä¸€ä¸ªç®€å•ä½†åŠŸèƒ½å®Œæ•´çš„Linuxåœ¨çº¿è¯„æµ‹ç³»ç»Ÿæ ¸å¿ƒï¼Œæä¾›å®‰å…¨çš„æ²™ç®±æ‰§è¡Œç¯å¢ƒã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”’ **å®‰å…¨æ²™ç®±**: ä½¿ç”¨chrootå’Œseccompæä¾›è¿›ç¨‹éš”ç¦»
- â±ï¸ **èµ„æºé™åˆ¶**: æ—¶é—´ã€å†…å­˜ã€è¾“å‡ºå¤§å°ç­‰å¤šç»´åº¦é™åˆ¶
- ğŸ“Š **è¯¦ç»†ç›‘æ§**: å®æ—¶ç›‘æ§ç¨‹åºæ‰§è¡ŒçŠ¶æ€å’Œèµ„æºä½¿ç”¨
- ğŸ¯ **ç²¾ç¡®è¯„æµ‹**: æ”¯æŒå¤šæµ‹è¯•ç”¨ä¾‹æ‰¹é‡è¯„æµ‹
- ğŸ“ **JSONè¾“å‡º**: ç»“æ„åŒ–çš„è¯„æµ‹ç»“æœè¾“å‡º

## ç³»ç»Ÿè¦æ±‚

- Linuxæ“ä½œç³»ç»Ÿ
- g++ç¼–è¯‘å™¨ (æ”¯æŒC++17)
- libjsoncpp-dev
- libseccomp-dev

## å®‰è£…ä¾èµ–

### Ubuntu/Debian
```bash
sudo apt-get update
sudo apt-get install g++ libjsoncpp-dev libseccomp-dev
```

### CentOS/RHEL
```bash
sudo yum install gcc-c++ jsoncpp-devel libseccomp-devel
```

## æ–‡ä»¶ç»“æ„

```
judge_core/
â”œâ”€â”€ limits.json          # æ‰§è¡Œé™åˆ¶é…ç½®
â”œâ”€â”€ stdin/              # è¾“å…¥æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ aplusb1.in
â”‚   â”œâ”€â”€ aplusb2.in
â”‚   â””â”€â”€ aplusb3.in
â”œâ”€â”€ stdout/             # æœŸæœ›è¾“å‡ºæ–‡ä»¶
â”‚   â”œâ”€â”€ aplusb1.out
â”‚   â”œâ”€â”€ aplusb2.out
â”‚   â””â”€â”€ aplusb3.out
â”œâ”€â”€ test.cpp            # å¾…è¯„æµ‹ç¨‹åº
â”œâ”€â”€ judge_core.cpp      # è¯„æµ‹æ ¸å¿ƒ
â”œâ”€â”€ run.sh              # ä¸€é”®å¯åŠ¨è„šæœ¬
â””â”€â”€ README.md           # è¯´æ˜æ–‡æ¡£
```

## ä½¿ç”¨æ–¹æ³•

### ä¸€é”®å¯åŠ¨
```bash
chmod +x run.sh
./run.sh
```

### æ‰‹åŠ¨ç¼–è¯‘è¿è¡Œ
```bash
# ç¼–è¯‘æµ‹è¯•ç¨‹åº
g++ -o test test.cpp -std=c++11

# ç¼–è¯‘è¯„æµ‹æ ¸å¿ƒ
g++ -o judge_core judge_core.cpp -std=c++17 \
    $(pkg-config --cflags --libs jsoncpp) \
    $(pkg-config --cflags --libs libseccomp) \
    -lstdc++fs

# è¿è¡Œè¯„æµ‹
./judge_core
```

## é…ç½®è¯´æ˜

### limits.json é…ç½®é¡¹

| é…ç½®é¡¹ | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| time_limit | æ—¶é—´é™åˆ¶(æ¯«ç§’) | 1000 |
| memory_limit | å†…å­˜é™åˆ¶(KB) | 65536 |
| cpu_limit | CPUæ ¸å¿ƒæ•°é™åˆ¶ | 1 |
| output_limit | è¾“å‡ºå¤§å°é™åˆ¶(å­—èŠ‚) | 65536 |
| stack_limit | æ ˆå¤§å°é™åˆ¶(KB) | 8192 |
| process_limit | è¿›ç¨‹æ•°é™åˆ¶ | 1 |
| file_size_limit | æ–‡ä»¶å¤§å°é™åˆ¶(å­—èŠ‚) | 1048576 |
| network_enabled | æ˜¯å¦å…è®¸ç½‘ç»œ | false |
| chroot_enabled | æ˜¯å¦å¯ç”¨chroot | true |
| seccomp_enabled | æ˜¯å¦å¯ç”¨seccomp | true |

## è¾“å‡ºç»“æœ

è¯„æµ‹å®Œæˆåä¼šç”Ÿæˆ `execute_message.json` æ–‡ä»¶ï¼ŒåŒ…å«è¯¦ç»†çš„è¯„æµ‹ç»“æœï¼š

```json
{
  "test_cases": [
    {
      "test_name": "aplusb1",
      "status": 0,
      "time_used": 5,
      "memory_used": 1024,
      "error_message": "",
      "output": "3\n",
      "time_limit_exceeded": false,
      "memory_limit_exceeded": false,
      "runtime_error": false,
      "system_error": false
    }
  ]
}
```

## å®‰å…¨ç‰¹æ€§

1. **è¿›ç¨‹éš”ç¦»**: ä½¿ç”¨forkåˆ›å»ºç‹¬ç«‹è¿›ç¨‹
2. **æ–‡ä»¶ç³»ç»Ÿéš”ç¦»**: chrooté™åˆ¶æ–‡ä»¶ç³»ç»Ÿè®¿é—®
3. **ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤**: seccompé™åˆ¶ç³»ç»Ÿè°ƒç”¨
4. **èµ„æºé™åˆ¶**: å¤šç»´åº¦èµ„æºä½¿ç”¨é™åˆ¶
5. **æ²™ç®±ç¯å¢ƒ**: ç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒ

## é”™è¯¯å¤„ç†

ç³»ç»Ÿèƒ½å¤Ÿæ£€æµ‹å’Œå¤„ç†ä»¥ä¸‹é”™è¯¯ï¼š

- æ—¶é—´é™åˆ¶è¶…æ—¶ (SIGXCPU)
- å†…å­˜é™åˆ¶è¶…é™
- è¾“å‡ºæ–‡ä»¶å¤§å°è¶…é™ (SIGXFSZ)
- æ®µé”™è¯¯ (SIGSEGV)
- ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ (SIGABRT)
- ç³»ç»Ÿè°ƒç”¨è¿è§„ (seccomp)

## æ‰©å±•ä½¿ç”¨

### æ·»åŠ æ–°çš„æµ‹è¯•ç”¨ä¾‹

1. åœ¨ `stdin/` ç›®å½•æ·»åŠ  `.in` æ–‡ä»¶
2. åœ¨ `stdout/` ç›®å½•æ·»åŠ å¯¹åº”çš„ `.out` æ–‡ä»¶
3. é‡æ–°è¿è¡Œè¯„æµ‹

### ä¿®æ”¹å¾…è¯„æµ‹ç¨‹åº

ç¼–è¾‘ `test.cpp` æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç¼–è¯‘è¿è¡Œã€‚

### è°ƒæ•´æ‰§è¡Œé™åˆ¶

ä¿®æ”¹ `limits.json` æ–‡ä»¶ä¸­çš„é…ç½®é¡¹ã€‚

## æ³¨æ„äº‹é¡¹

1. éœ€è¦åœ¨Linuxç³»ç»Ÿä¸Šè¿è¡Œ
2. éœ€è¦rootæƒé™æˆ–é€‚å½“çš„ç³»ç»Ÿæƒé™
3. ç¡®ä¿ç³»ç»Ÿå·²å®‰è£…å¿…è¦çš„ä¾èµ–åº“
4. è¯„æµ‹ç¨‹åºåº”è¯¥æ˜¯å¯æ‰§è¡Œæ–‡ä»¶

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚ 